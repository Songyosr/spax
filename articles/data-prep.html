<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2. Understanding the Trade-offs: Data Preparation for Spatial Accessibility Analysis • spax</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. Understanding the Trade-offs: Data Preparation for Spatial Accessibility Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spax</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data-prep.html">2. Understanding the Trade-offs: Data Preparation for Spatial Accessibility Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/spax-101-intro.html">1. Getting Started with spax: A Healthcare Accessibility Case Study</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/songyos/spax/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>2. Understanding the Trade-offs: Data Preparation for Spatial Accessibility Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/songyos/spax/blob/main/vignettes/data-prep.Rmd" class="external-link"><code>vignettes/data-prep.Rmd</code></a></small>
      <div class="d-none name"><code>data-prep.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-raster-approach-understanding-the-trade-offs">The Raster Approach: Understanding the Trade-offs<a class="anchor" aria-label="anchor" href="#the-raster-approach-understanding-the-trade-offs"></a>
</h2>
<p>When working with spatial accessibility analysis, one of the first
decisions is how to represent spatial data. The <code>spax</code>
package takes a raster-based approach (at least for now), representing
space as a grid of regular cells rather than points and polygons. This
fundamental choice shapes everything from memory usage to computational
methods.</p>
<div class="section level3">
<h3 id="memory-vs--computational-simplicity">Memory vs. Computational Simplicity<a class="anchor" aria-label="anchor" href="#memory-vs--computational-simplicity"></a>
</h3>
<p>Let’s be upfront about the costs and benefits. Raster representations
typically require more memory than their vector counterparts:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare memory usage between vector and raster isochrones</span></span>
<span><span class="va">vec_size</span> <span class="op">&lt;-</span> <span class="fu">object_size</span><span class="op">(</span><span class="va">hos_iscvec</span><span class="op">)</span><span class="op">/</span><span class="fl">1024</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">rast_size</span> <span class="op">&lt;-</span> <span class="fu">object_size</span><span class="op">(</span><span class="va">hos_iscr</span><span class="op">)</span><span class="op">/</span><span class="fl">1024</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Memory usage comparison:\n"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Vector isochrones: %.1f MB\n"</span>, <span class="va">vec_size</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Raster isochrones: %.1f MB\n"</span>, <span class="va">rast_size</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Memory increase factor: %.1fx\n"</span>, <span class="va">rast_size</span><span class="op">/</span><span class="va">vec_size</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Memory usage comparison:</span></span>
<span><span class="co">#&gt;  Vector isochrones: 5.9 MB</span></span>
<span><span class="co">#&gt;  Raster isochrones: 194.0 MB</span></span>
<span><span class="co">#&gt;  Memory increase factor: 32.7x</span></span></code></pre></div>
<p>As we can see, raster isochrones are 32.7 times larger than vector
isochrones*. So, why accept this memory overhead? The benefits come down
to algorithmic simplicity and computational consistency:</p>
<blockquote>
<p><strong>*Note:</strong> The actual memory increase factor may vary
depending on the resolution and complexity of the raster data.</p>
</blockquote>
<div class="section level5">
<h5 id="computational-efficiency">1. Computational Efficiency<a class="anchor" aria-label="anchor" href="#computational-efficiency"></a>
</h5>
<p>Raster operations translate directly into matrix operations, which
modern computers are highly optimized to handle. Instead of complex
geometric calculations, we’re essentially doing math on a grid:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simple example: </span></span>
<span><span class="co"># 1. Calculate areas within 30 minutes of a facility</span></span>
<span><span class="co"># 2. Calculate Gaussian distance decay with an SD of 30 minutes</span></span>
<span><span class="co"># 3. Calculate Exponential distance decay with a decay rate of 0.05</span></span>
<span></span>
<span><span class="va">distance_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">hos_iscr</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="co"># Travel time to first facility</span></span>
<span></span>
<span><span class="co"># Set grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Distance raster</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">distance_raster</span>, main <span class="op">=</span> <span class="st">"Travel Time to Hospital C1 (minutes)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound0</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Area within 30 minutes</span></span>
<span><span class="va">within_30min</span> <span class="op">&lt;-</span> <span class="va">distance_raster</span> <span class="op">&lt;=</span> <span class="fl">30</span>    <span class="co"># Simple logical operation</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">within_30min</span>, main <span class="op">=</span> <span class="st">"Area within 30 minutes"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound0</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gaussian decay</span></span>
<span><span class="va">gaussian_decay</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">distance_raster</span> <span class="op">/</span> <span class="fl">30</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>  <span class="co">#</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gaussian_decay</span>, main <span class="op">=</span> <span class="st">"Gaussian Distance Decay"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound0</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exponential decay</span></span>
<span><span class="va">exponential_decay</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span> <span class="op">*</span> <span class="va">distance_raster</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">exponential_decay</span>, main <span class="op">=</span> <span class="st">"Exponential Distance Decay"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound0</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-1-1.png" width="1200"></p>
</div>
<div class="section level5">
<h5 id="data-structure-consistency">2. Data Structure Consistency<a class="anchor" aria-label="anchor" href="#data-structure-consistency"></a>
</h5>
<p>Almost everything - population, travel times, accessibility scores -
lives in the same format (maybe except supply-demand ratio calulation
that performs as a vector). This eliminates the need to convert between
different spatial representations:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show how different components share the same structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Population density</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">u5pd</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Population"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Travel time</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">distance_raster</span>, main <span class="op">=</span> <span class="st">"Travel Time"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Result will have same structure</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">within_30min</span>, main <span class="op">=</span> <span class="st">"Analysis Result"</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-2-1.png" width="1200"></p>
</div>
<div class="section level5">
<h5 id="built-in-spatial-relationships">3. Built-in Spatial Relationships<a class="anchor" aria-label="anchor" href="#built-in-spatial-relationships"></a>
</h5>
<p>The grid structure automatically encodes spatial relationships. We
don’t need separate distance matrices or spatial indices - the cell
positions themselves tell us what’s near what.</p>
</div>
</div>
<div class="section level3">
<h3 id="when-to-consider-alternatives">When to Consider Alternatives<a class="anchor" aria-label="anchor" href="#when-to-consider-alternatives"></a>
</h3>
<p>The raster approach isn’t always optimal. Consider vector-based
methods when:</p>
<ul>
<li>Your study area is very sparse with few service locations</li>
<li>You need exact precision at specific points</li>
<li>Memory is severely constrained and you’re working with a large
area</li>
<li>The granularity of your analysis doesn’t require a continuous
surface</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="data-preparation-for-accessibility-analysis">Data Preparation for Accessibility Analysis<a class="anchor" aria-label="anchor" href="#data-preparation-for-accessibility-analysis"></a>
</h2>
<blockquote>
<p><em>“Give me six hours to chop down a tree, and I will spend the
first four sharpening the axe.”</em></p>
<p>— Often attributed to Abraham Lincoln</p>
</blockquote>
<div class="section level3">
<h3 id="dealing-with-demand">Dealing with Demand<a class="anchor" aria-label="anchor" href="#dealing-with-demand"></a>
</h3>
<p>When preparing demand data for spatial accessibility analysis, we
have several approaches available, each with its own assumptions and
trade-offs. Let’s explore these methods using a simple example of
disease cases by district.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span> <span class="co"># For reproducibility</span></span>
<span></span>
<span><span class="co"># Example district-level case data</span></span>
<span><span class="va">case_data</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  ADM1_PCODE <span class="op">=</span> <span class="va">bound1</span><span class="op">$</span><span class="va">ADM1_PCODE</span>,</span>
<span>  cases <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bound1</span><span class="op">)</span>, <span class="fl">1000</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Simulated disease cases</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join with spatial data</span></span>
<span><span class="va">case_spatial</span> <span class="op">&lt;-</span> <span class="va">bound1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">case_data</span>, by <span class="op">=</span> <span class="st">"ADM1_PCODE"</span><span class="op">)</span></span></code></pre></div>
<p>In a vector-based approach, we typically represent each area with a
polygon that has an attribute for the number of cases. This often
results in choropleth maps, like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the case</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bound1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">case_spatial</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">cases</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by Province"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_b</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-3-1.png" width="1200"></p>
<p>But that could sometimes be misleading as when performing spatial
analysis; we often allocate demand to only at the centroid of each area,
like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate centroids and rasterize</span></span>
<span><span class="va">centroids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">case_spatial</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span></span>
<span><span class="co"># Plot the population data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bound1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">centroids</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">cases</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Population Data by Region"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-4-1.png" width="1200"></p>
<p>and then we proceed to estimate the pair distance between each
centroid-facility pair to calculate the decay weight and accessibility
score.</p>
<p>Now, let’s see how we can deal with the demand in a raster-centric
method.</p>
<div class="section level4">
<h4 id="centroid-based-approach">1. Centroid-Based Approach<a class="anchor" aria-label="anchor" href="#centroid-based-approach"></a>
</h4>
<p>The simplest approach treats all demand as concentrated at area
centroids. This mirrors traditional vector-based accessibility
analyses:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create template raster - Coarser resolution for example</span></span>
<span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">u5pd</span><span class="op">)</span>, fact <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># Rasterize centroids</span></span>
<span><span class="va">centroid_demand</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rasterize.html" class="external-link">rasterize</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">centroids</span><span class="op">)</span>, </span>
<span>  <span class="va">template</span>,</span>
<span>  field <span class="op">=</span> <span class="st">"cases"</span>, </span>
<span>  fun <span class="op">=</span> <span class="st">"sum"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">centroid_demand</span>, main <span class="op">=</span> <span class="st">"Centroid-Based Demand"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound1</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-5-1.png" width="1200"></p>
<p>As you can see here, the centroid vector data has been converted into
a raster format (despite its weird-looking result). However, this raster
can now be used in the accessibility analysis, just like the original
population density raster.</p>
<table style="width:90%;" class="table">
<colgroup>
<col width="36%">
<col width="54%">
</colgroup>
<thead><tr class="header">
<th>Pros</th>
<th>Cons</th>
</tr></thead>
<tbody><tr class="odd">
<td><ul>
<li>Simple to implement</li>
</ul></td>
<td><ul>
<li>Unrealistic spatial distribution</li>
</ul></td>
</tr></tbody>
</table>
</div>
<div class="section level4">
<h4 id="area-weighted-approach-developing">2. Area-Weighted Approach [developing]<a class="anchor" aria-label="anchor" href="#area-weighted-approach-developing"></a>
</h4>
<p>Now, we can really take a choropleth map into analysis. This method
assumes cases are uniformly distributed across each district:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># test</span></span>
<span><span class="va">case_spatial_spat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">case_spatial</span><span class="op">)</span></span>
<span><span class="va">case_spatial_spat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/expanse.html" class="external-link">expanse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7741349548 2881574102 4709743120 3860384248 1966320543 4472740197 4487557469</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rasterize.html" class="external-link">rasterize</a></span><span class="op">(</span><span class="va">case_spatial_spat</span>, <span class="va">template</span>, field <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-6-1.png" width="1200"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Calculate case density</span></span>
<span><span class="va">case_spatial</span> <span class="op">&lt;-</span> <span class="va">case_spatial</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    area_m2 <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">case_spatial</span><span class="op">)</span>,  <span class="co"># estimate area</span></span>
<span>    case_density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cases</span> <span class="op">/</span> <span class="va">area_m2</span><span class="op">)</span>  <span class="co"># calc density</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Rasterize case density</span></span>
<span><span class="va">case_density_raster</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rasterize.html" class="external-link">rasterize</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">case_spatial</span><span class="op">)</span>,</span>
<span>  <span class="va">template</span>,</span>
<span>  field <span class="op">=</span> <span class="st">"case_density"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Calculate pixel area in square kilometers</span></span>
<span><span class="va">pixel_area</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">template</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">template</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># 4. Convert density to absolute cases per pixel</span></span>
<span><span class="va">case_raster</span> <span class="op">&lt;-</span> <span class="va">case_density_raster</span> <span class="op">*</span> <span class="va">pixel_area</span></span></code></pre></div>
<p>And you would have some thing like this:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot </span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">case_raster</span>, main <span class="op">=</span> <span class="st">"Area-Weighted Demand"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound1</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-8-1.png" width="1200"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract raster values for each polygon</span></span>
<span><span class="va">extracted_cases</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">case_raster</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">case_spatial</span><span class="op">)</span>, fun <span class="op">=</span> <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">case_spatial</span> <span class="op">&lt;-</span> <span class="va">case_spatial</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    raster_cases <span class="op">=</span> <span class="va">extracted_cases</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>  <span class="co"># Extracted values</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare the result</span></span>
<span><span class="va">case_spatial</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">ADM1_PCODE</span>, <span class="va">cases</span>, <span class="va">raster_cases</span><span class="op">)</span></span>
<span><span class="co">#&gt;   ADM1_PCODE cases raster_cases</span></span>
<span><span class="co">#&gt; 1       TH90  1274    1261.3804</span></span>
<span><span class="co">#&gt; 2       TH91   887     867.4381</span></span>
<span><span class="co">#&gt; 3       TH92  1073    1068.1381</span></span>
<span><span class="co">#&gt; 4       TH93  1127    1131.1109</span></span>
<span><span class="co">#&gt; 5       TH94  1081    1085.9092</span></span>
<span><span class="co">#&gt; 6       TH95   979     995.1537</span></span>
<span><span class="co">#&gt; 7       TH96  1302    1286.7563</span></span>
<span></span>
<span><span class="co"># Due to the demand approximation, the raster-based method may not exactly match the original case counts. The results, though, will geting closer as the resolution increas.es</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="informed-distribution-developing">3. Informed Distribution [developing]<a class="anchor" aria-label="anchor" href="#informed-distribution-developing"></a>
</h4>
<p>This approach uses auxiliary data (like population density) to
distribute cases more realistically:</p>
</div>
<div class="section level4">
<h4 id="probabilistic-sampling-developing">4. Probabilistic Sampling [developing]<a class="anchor" aria-label="anchor" href="#probabilistic-sampling-developing"></a>
</h4>
<p>For uncertainty analysis, spax provides the sample_pmf() function to
generate multiple realizations of demand distributions:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This advanced approach is covered in detail in the "Probabilistic Accessibility Analysis" vignette (developing)</span></span>
<span><span class="op">?</span><span class="va">sample_pmf</span>  <span class="co"># See documentation for details</span></span></code></pre></div>
<p>The choice of demand preparation method can significantly impact your
accessibility analysis results. Consider your specific context:</p>
<ul>
<li>Data availability (Do you have population density data?)</li>
<li>Scale of analysis (Are districts large enough that distribution
matters?)</li>
<li>Purpose (Is point-based analysis sufficient for your needs?)</li>
<li>Computational resources (Can you handle higher resolution
distributions?) ### Processing Supply Data &amp; Distance Raster</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="processing-supply-and-distance-data">Processing Supply and Distance Data<a class="anchor" aria-label="anchor" href="#processing-supply-and-distance-data"></a>
</h3>
<div class="section level4">
<h4 id="supply-data-the-known-part-of-the-equation">Supply Data: The Known Part of the Equation<a class="anchor" aria-label="anchor" href="#supply-data-the-known-part-of-the-equation"></a>
</h4>
<p>Supply locations are typically the most straightforward component of
accessibility analysis - we usually know exactly where facilities are
and their capacities. However, there are still important considerations
in preparing this data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example of typical supply data structure</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, <span class="va">hoslvl</span>, <span class="va">s_doc</span>, <span class="va">s_nurse</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 4 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 659422 ymin: 744135 xmax: 715990.7 ymax: 824148</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / UTM zone 47N</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   id    hoslvl     s_doc s_nurse            geometry</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> c172  3-Regional   522     973 (662036.1 775836.7)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> c173  2-General    321     706   (672852 789753.3)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> c174  2-General     67      63     (659422 824148)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> c175  2-General     81     103     (692195 764766)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> c176  2-General    175     180   (687203.3 744135)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> c177  2-General     77     103 (715990.7 752559.6)</span></span></code></pre></div>
<p>Supply data typically starts as point locations with attributes (as
it’s usually a known part of our equation). Let’s say we have a dataset
of hospital capacity in the region, and we geo-located each of them, you
might get something like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dissect the original data </span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 10 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 659422 ymin: 744135 xmax: 715990.7 ymax: 824148</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / UTM zone 47N</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 11</span></span></span>
<span><span class="co">#&gt;   id    hoslvl       bed s_doc s_dent s_nurse  s_hv d_pop_moph d_pop_moph_60</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> c172  3-Regional   591   522     44     973     0          0             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> c173  2-General    508   321     18     706     0          0             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> c174  2-General     30    67      6      63     0          0             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> c175  2-General     60    81      9     103     0          0             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> c176  2-General     90   175     12     180     0          0             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> c177  2-General     60    77      9     103     0          0             0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: d_pop_moph_05 &lt;dbl&gt;, geometry &lt;POINT [m]&gt;</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sf"         "tbl_df"     "tbl"        "data.frame"</span></span></code></pre></div>
<p>For use in <code>spax</code>, supply data should be separated
into:</p>
<ol style="list-style-type: decimal">
<li>Spatial locations (for distance calculations)</li>
<li>Capacity attributes (for accessibility computations)</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Separate spatial and attribute components</span></span>
<span><span class="va">supply_attributes</span> <span class="op">&lt;-</span> <span class="va">hc12_hos</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, <span class="va">s_doc</span>, <span class="va">s_nurse</span><span class="op">)</span>  <span class="co"># Keep only relevant columns</span></span>
<span></span>
<span><span class="co"># Visual check of supply distribution</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bound1</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">hc12_hos</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">s_doc</span>, color <span class="op">=</span> <span class="va">hoslvl</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Number of Doctors"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Hospital Level"</span>, end <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Healthcare Supply Distribution"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Size indicates number of doctors, color shows facility level"</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-13-1.png" width="1200"></p>
</div>
<div class="section level4">
<h4 id="creating-distancetravel-time-surfaces">Creating Distance/Travel Time Surfaces<a class="anchor" aria-label="anchor" href="#creating-distancetravel-time-surfaces"></a>
</h4>
<p>On the other hand, the most complex part of data preparation, in my
opinion, is often creating travel time or distance surfaces. You have
several options:</p>
<div class="section level5">
<h5 id="euclidean-distance">1. Euclidean Distance<a class="anchor" aria-label="anchor" href="#euclidean-distance"></a>
</h5>
<p>The simplest approach - straight-line distances:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example for one facility using terra</span></span>
<span><span class="va">facility_point</span> <span class="op">&lt;-</span> <span class="va">hc12_hos</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="va">template_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">u5pd</span><span class="op">)</span>  <span class="co"># Use population raster as template</span></span>
<span></span>
<span><span class="co"># Calculate Euclidean distance (in meters since our CRS is projected)</span></span>
<span><span class="va">euclidean_dist</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/distance.html" class="external-link">distance</a></span><span class="op">(</span></span>
<span>  <span class="va">template_rast</span>, </span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">facility_point</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound0</span><span class="op">)</span>, mask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; |---------|---------|---------|---------|=========================================                                          </span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the Euclidean distance</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">euclidean_dist</span> <span class="op">/</span> <span class="fl">1000</span>, <span class="co"># Convert to kilometers</span></span>
<span>     main <span class="op">=</span> <span class="st">"Euclidean Distance (km)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">facility_point</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound0</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-15-1.png" width="1200"></p>
<p>And then you can loop over all facilities to calculate the distance
raster for each facility.</p>
</div>
<div class="section level5">
<h5 id="travel-time-isochrones">2. Travel Time Isochrones<a class="anchor" aria-label="anchor" href="#travel-time-isochrones"></a>
</h5>
<p>Another way to go is to create travel time isochrones, which
represent areas reachable from a location within a given time threshold.
This package did not provide a function to generate isochrones, but we
can use the <a href="https://github.com/riatelab/osrm" class="external-link uri"><code>osrm</code></a> package to calculate travel times
rings around each supply location.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Calculate isochrones for the first hospital</span></span>
<span><span class="co"># Since the dataset I've prepared is in a planar projection, we need to transform it to WGS84 (EPSG:4326) for routing services</span></span>
<span></span>
<span><span class="op">(</span><span class="va">example_hos1</span> <span class="op">&lt;-</span> <span class="va">hc12_hos</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">|&gt;</span> <span class="co"># Select the first hospital</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Transform to WGS84 (geodesic projection)</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Extract coordinates</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Convert to numeric</span></span>
<span><span class="co">#&gt; [1] 100.466936   7.016594</span></span>
<span></span>
<span><span class="co"># Calculate isochrones</span></span>
<span><span class="va">example_isochrone</span> <span class="op">&lt;-</span> <span class="fu">osrmIsochrone</span><span class="op">(</span></span>
<span>  loc <span class="op">=</span> <span class="va">example_hos1</span>, <span class="co"># Example coordinates</span></span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">45</span>, <span class="fl">60</span><span class="op">)</span>, <span class="co"># 15-minute intervals</span></span>
<span>  res <span class="op">=</span> <span class="fl">30</span> </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change crs back</span></span>
<span><span class="op">(</span><span class="va">example_isochrone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">example_isochrone</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">bound0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 4 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 611291.2 ymin: 699250.9 xmax: 714914.9 ymax: 835552.2</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / UTM zone 47N</span></span>
<span><span class="co">#&gt;   id isomin isomax                       geometry</span></span>
<span><span class="co">#&gt; 1  1      0     15 MULTIPOLYGON (((666119.5 78...</span></span>
<span><span class="co">#&gt; 2  2     15     30 MULTIPOLYGON (((674296.6 79...</span></span>
<span><span class="co">#&gt; 3  3     30     45 MULTIPOLYGON (((674252.3 80...</span></span>
<span><span class="co">#&gt; 4  4     45     60 MULTIPOLYGON (((616774.1 81...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">example_isochrone</span><span class="op">[</span>, <span class="st">"isomax"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Travel Time Isochrone for Hospital C1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-16-1.png" width="1200"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">example_isochrone</span><span class="op">[</span><span class="fl">3</span>, <span class="st">"isomax"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Travel Time Isochrone ring for Hospital C1 (45 mins)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-16-2.png" width="1200"></p>
<p>As you can see, osrmIsochrone calculates the area reachable within
each time threshold for the first hospital (C1) in 15-minute intervals
up to 60 minutes as distinct ring-shaped vectors. If you take on a
vector-based approach, you can use functions like
<code>st_contain()</code> to determine the population within each
isochrone ring. But in our raster-centric package, we’ll rasterize these
isochrones for further analysis.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a iso_mean column, and id</span></span>
<span><span class="va">example_isochrone</span> <span class="op">&lt;-</span> <span class="va">example_isochrone</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    iso_mean <span class="op">=</span> <span class="op">(</span><span class="va">isomin</span> <span class="op">+</span> <span class="va">isomax</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>    location_id <span class="op">=</span> <span class="va">hc12_hos</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">$</span><span class="va">id</span> <span class="co"># actually dont need it here</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert isochrones to raster format</span></span>
<span><span class="va">example_raster</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rasterize.html" class="external-link">rasterize</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">example_isochrone</span>,</span>
<span>  y <span class="op">=</span> <span class="va">template_rast</span>, </span>
<span>  field <span class="op">=</span> <span class="st">"iso_mean"</span>, <span class="co"># Fill the raster with the isomax values</span></span>
<span>  background <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  fun <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"location_id"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound0</span><span class="op">)</span>, mask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">example_raster</span>, main <span class="op">=</span> <span class="st">"Travel Time Isochrone for Hospital C1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound0</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-18-1.png" width="1200"></p>
<p>To analyze all hospitals, we can iterate through each facility and
compute their isochrones. By default, the osrmIsochrone function uses
the OSRM demo server to perform these calculations. However, relying on
the demo server is not recommended for large datasets or repeated
analyses due to usage limits and ethical considerations. Instead, it’s
advisable to <a href="https://github.com/Project-OSRM/osrm-backend" class="external-link">set
up your own OSRM server</a>. This vignette does not cover the server
setup process.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example of looping over all hospitals to calculate isochrones</span></span>
<span><span class="co"># Note: This code is for illustration only and may not run due to API limitations</span></span>
<span><span class="co"># Initialize a list to store isochrones</span></span>
<span><span class="va">isochrones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract coordinates</span></span>
<span><span class="va">hos_coords</span> <span class="op">&lt;-</span> <span class="va">hc12_hos</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># only if the data is in planar projection</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop over each hospital - lapply</span></span>
<span><span class="va">isochrones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Calculate isochrone</span></span>
<span>  <span class="fu">osrmIsochrone</span><span class="op">(</span></span>
<span>    loc <span class="op">=</span> <span class="va">hos_coords</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">45</span>, <span class="fl">60</span><span class="op">)</span>,</span>
<span>    res <span class="op">=</span> <span class="fl">30</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> </span>
<span><span class="co"># Then proceed to rastarization ...</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="service-provider-options">Service Provider Options<a class="anchor" aria-label="anchor" href="#service-provider-options"></a>
</h4>
<p><strong>OSRM (Open Source Routing Machine)</strong></p>
<ul>
<li>Free and open source</li>
<li>Requires setting up your own server for large analyses</li>
<li>Good for road-based travel times (you can actually use it for other
traveling modes, but that requires more setup)</li>
</ul>
<p><strong>HERE, Google Maps, or other APIs</strong></p>
<ul>
<li>More accurate traffic data</li>
<li>Cost associated with usage</li>
<li>May have usage limits</li>
</ul>
<p><strong>Custom cost surfaces</strong> (I have no idea how to do this,
lol)</p>
<ul>
<li>Can incorporate terrain, land use</li>
<li>Requires more GIS expertise</li>
<li>Good for non-road-based accessibility</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="memory-considerations">Memory Considerations<a class="anchor" aria-label="anchor" href="#memory-considerations"></a>
</h3>
<p>Travel time surfaces often dominate memory usage. For <em>n</em>
facilities and a raster of <em>m</em> cells, you need space for <em>n ×
m</em> values:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate memory requirements</span></span>
<span><span class="va">cells_per_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">u5pd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">n_facilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hc12_hos</span><span class="op">)</span></span>
<span><span class="va">bytes_per_value</span> <span class="op">&lt;-</span> <span class="fl">8</span>  <span class="co"># Double precision float</span></span>
<span></span>
<span><span class="va">total_mb</span> <span class="op">&lt;-</span> <span class="va">cells_per_raster</span> <span class="op">*</span> <span class="va">n_facilities</span> <span class="op">*</span> <span class="va">bytes_per_value</span> <span class="op">/</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Memory required for ~520*520 m^2 resolution: %.1f MB\n"</span>, <span class="va">total_mb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Memory required for ~520*520 m^2 resolution: 193.5 MB</span></span>
<span></span>
<span><span class="co"># Option: Reduce resolution for initial analysis</span></span>
<span><span class="va">cells_per_raster_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">u5pd</span>, fact <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">total_mb_2</span> <span class="op">&lt;-</span> <span class="va">cells_per_raster_2</span> <span class="op">*</span> <span class="va">n_facilities</span> <span class="op">*</span> <span class="va">bytes_per_value</span> <span class="op">/</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Memory required for ~1040*1040 m^2 resolution: %.1f MB\n"</span>, <span class="va">total_mb_2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Memory required for ~1040*1040 m^2 resolution: 48.5 MB</span></span></code></pre></div>
<p><strong>Tips for managing memory:</strong></p>
<ul>
<li>Start with lower resolution for testing</li>
<li>Consider using chunks for large spatial datasets</li>
<li>Clean up unused objects during processing</li>
</ul>
</div>
<div class="section level3">
<h3 id="validating-your-data-essential-checks-before-analysis">Validating Your Data: Essential Checks Before Analysis<a class="anchor" aria-label="anchor" href="#validating-your-data-essential-checks-before-analysis"></a>
</h3>
<p>Before running any accessibility analysis, it’s crucial to validate
your prepared data. Here’s a systematic approach to validation (some of
which already implemented in the package:) :</p>
<div class="section level5">
<h5 id="spatial-alignment">1. Spatial Alignment<a class="anchor" aria-label="anchor" href="#spatial-alignment"></a>
</h5>
<p>All raster inputs must align perfectly - same extent, resolution, and
projection:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example:</span></span>
<span><span class="co"># You might want to create function to summarize raster properties</span></span>
<span><span class="va">summarize_raster</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">r</span>, <span class="va">name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">tibble</span><span class="op">(</span></span>
<span>    Dataset <span class="op">=</span> <span class="va">name</span>,</span>
<span>    Resolution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span> , collapse <span class="op">=</span> <span class="st">" x "</span><span class="op">)</span>,</span>
<span>    Extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    CRS <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">r</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compare properties of key rasters</span></span>
<span><span class="va">raster_props</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>  <span class="fu">summarize_raster</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">u5pd</span><span class="op">)</span>, <span class="st">"Population"</span><span class="op">)</span>,</span>
<span>  <span class="fu">summarize_raster</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">hos_iscr</span><span class="op">)</span>, <span class="st">"Travel Time"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">raster_props</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   Dataset     Resolution    Extent                                     CRS      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Population  520.4 x 520.4 505646.53, 842347.77, 620843.72, 885729.24 +proj=ut…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Travel Time 520.4 x 520.4 505646.53, 842347.77, 620843.72, 885729.24 +proj=ut…</span></span>
<span></span>
<span><span class="co"># Visual check for alignment</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">u5pd</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Spatial Alignment Check"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">hos_iscr</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound1</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-21-1.png" width="1200"></p>
</div>
<div class="section level5">
<h5 id="value-range-validation">2. Value Range Validation<a class="anchor" aria-label="anchor" href="#value-range-validation"></a>
</h5>
<p>Check for reasonable values in your input data:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check population density range</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">u5pd</span><span class="op">)</span></span>
<span><span class="co">#&gt;         tha_children_under_five_2020</span></span>
<span><span class="co">#&gt; Min.                    0.000000e+00</span></span>
<span><span class="co">#&gt; 1st Qu.                 1.385807e+00</span></span>
<span><span class="co">#&gt; Median                  3.497750e+00</span></span>
<span><span class="co">#&gt; 3rd Qu.                 7.571418e+00</span></span>
<span><span class="co">#&gt; Max.                    8.307421e+01</span></span>
<span><span class="co">#&gt; NA's                    2.781020e+05</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hos_iscr</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>  <span class="co"># Check a few travel time rasters</span></span>
<span><span class="co">#&gt; Warning in .local(object, ...): summary is an estimate based on a sample of 1e+05 cells (30.37% of all cells)</span></span>
<span><span class="co">#&gt;             c172     c173     c174     c175     c176     c177     c178     c179</span></span>
<span><span class="co">#&gt; Min.         6.0      3.0      3.5      4.0      8.5     11.0      5.0      7.5</span></span>
<span><span class="co">#&gt; 1st Qu.     67.5     67.5     82.5     67.5     67.5     67.5     67.5     97.5</span></span>
<span><span class="co">#&gt; Median      97.5    112.5    127.5    112.5    112.5    112.5    112.5    127.5</span></span>
<span><span class="co">#&gt; 3rd Qu.    142.5    142.5    157.5    142.5    142.5    142.5    157.5    157.5</span></span>
<span><span class="co">#&gt; Max.       172.5    172.5    172.5    172.5    172.5    172.5    172.5    172.5</span></span>
<span><span class="co">#&gt; NA's    232772.0 232555.0 241578.0 226680.0 231076.0 235489.0 241789.0 246926.0</span></span>
<span><span class="co">#&gt;             c180     c181</span></span>
<span><span class="co">#&gt; Min.         5.0      8.5</span></span>
<span><span class="co">#&gt; 1st Qu.     97.5     67.5</span></span>
<span><span class="co">#&gt; Median     127.5     97.5</span></span>
<span><span class="co">#&gt; 3rd Qu.    157.5    127.5</span></span>
<span><span class="co">#&gt; Max.       172.5    172.5</span></span>
<span><span class="co">#&gt; NA's    247713.0 236889.0</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="missing-value-analysis">3. Missing Value Analysis<a class="anchor" aria-label="anchor" href="#missing-value-analysis"></a>
</h5>
<p>Understand where and why you have NA values; note that not all NAs
are bad:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to analyze NA patterns within boundary</span></span>
<span><span class="va">analyze_nas</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">r</span>, <span class="va">name</span>, <span class="va">bound</span> <span class="op">=</span> <span class="va">bound0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Create mask from boundary</span></span>
<span>  <span class="va">mask</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rasterize.html" class="external-link">rasterize</a></span><span class="op">(</span><span class="va">bound</span>, <span class="va">r</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Count cells only within boundary</span></span>
<span>  <span class="va">cells_in_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/global.html" class="external-link">global</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span>, <span class="st">"sum"</span><span class="op">)</span><span class="op">$</span><span class="va">sum</span></span>
<span>  <span class="va">nas_in_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/global.html" class="external-link">global</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span>, <span class="st">"sum"</span><span class="op">)</span><span class="op">$</span><span class="va">sum</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s:\n"</span>, <span class="va">name</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  NA cells within boundary: %d (%.1f%% of study area)\n"</span>, </span>
<span>              <span class="va">nas_in_boundary</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">nas_in_boundary</span><span class="op">/</span><span class="va">cells_in_boundary</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Visualize NA pattern</span></span>
<span>  <span class="va">na_map</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">bound</span>, mask <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">na_map</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"- NAs within Study Area"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey80"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>       legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">bound1</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, </span>
<span>         legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Data present"</span>, <span class="st">"NA"</span><span class="op">)</span>,</span>
<span>         fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey80"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>         bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check NA patterns in key datasets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">analyze_nas</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">u5pd</span><span class="op">)</span>, <span class="st">"Pop"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Pop:</span></span>
<span><span class="co">#&gt;    NA cells within boundary: 60551 (54.4% of study area)</span></span>
<span><span class="fu">analyze_nas</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">hos_iscr</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"Time from 1st Fac"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time from 1st Fac:</span></span>
<span><span class="co">#&gt;    NA cells within boundary: 16841 (15.1% of study area)</span></span></code></pre></div>
<p><img src="data-prep_files/figure-html/unnamed-chunk-23-1.png" width="1200"></p>
</div>
<div class="section level4">
<h4 id="final-reminders">Final reminders:<a class="anchor" aria-label="anchor" href="#final-reminders"></a>
</h4>
<ol style="list-style-type: decimal">
<li>
<p><strong>Resolution Selection</strong></p>
<ul>
<li>Higher resolution ≠ better analysis</li>
<li>Consider computational resources</li>
<li>Match resolution to spatial scale of research question</li>
</ul>
</li>
<li>
<p><strong>Coordinate Reference Systems</strong></p>
<ul>
<li>Be consistent with CRS across all datasets</li>
<li>Document CRS choices and transformations</li>
</ul>
</li>
</ol>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>With your data prepared, you’re ready to move on to actual
accessibility analysis. The next vignette will cover how
<code>spax</code> functions work together to compute accessibility
scores.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Songyos Rajborirug.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
